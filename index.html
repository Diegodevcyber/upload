<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>Upload Persistente</title>
    <style>
        body { font-family: sans-serif; display: flex; justify-content: center; align-items: center; min-height: 100vh; background: #1a1a1a; color: white; }
        .box { background: #2a2a2a; padding: 2rem; border-radius: 12px; text-align: center; box-shadow: 0 10px 25px rgba(0,0,0,0.5); width: 350px; }
        input { margin: 15px 0; width: 100%; }
        button { background: #007bff; color: white; border: none; padding: 12px; border-radius: 6px; cursor: pointer; width: 100%; font-weight: bold; }
        #status { margin-top: 15px; font-size: 14px; }
        #result { margin-top: 15px; overflow-wrap: break-word; }
        a { color: #00ffcc; text-decoration: none; font-weight: bold; }
    </style>
</head>
<body>
    <div class="box">
        <h2>☁️ Envio de Arquivos</h2>
        <input type="file" id="meuArquivo" accept="image/*,.pdf">
        <button onclick="fazerUpload()">Realizar Upload</button>
        <div id="status">Aguardando...</div>
        <div id="result"></div>
    </div>

    <script>
        async function fazerUpload() {
            const fileInput = document.getElementById('meuArquivo');
            const status = document.getElementById('status');
            const result = document.getElementById('result');
            
            if (!fileInput.files[0]) return alert("Selecione um arquivo primeiro!");

            status.innerText = "⌛ Enviando para a nuvem...";
            result.innerHTML = "";

            const formData = new FormData();
            // O nome 'file' aqui deve ser igual ao upload.single('file') no seu server.js
            formData.append('file', fileInput.files[0]);

            try {
                // CORREÇÃO: Adicionado o final "/upload" na URL
                const response = await fetch('https://meuupload.onrender.com/upload', {
                    method: 'POST',
                    body: formData
                });

                // Verifica se a resposta foi bem sucedida antes de tentar ler o JSON
                if (!response.ok) {
                    throw new Error('Falha na resposta do servidor');
                }

                const data = await response.json();
                
                if (data.url) {
                    status.innerText = "✅ Upload Concluído!";
                    result.innerHTML = `Link permanente:<br><a href="${data.url}" target="_blank">Clique aqui para ver</a>`;
                } else {
                    status.innerText = "❌ Erro: " + (data.error || "Erro no servidor.");
                }
            } catch (err) {
                status.innerText = "❌ Erro de Conexão. Verifique se o servidor no Render está acordado.";
                console.error(err);
            }
        }
    </script>
</body>
</html>